.PHONY: init plan apply destroy output validate fmt

# Variables
TF_DIR = .
TF_VAR_FILE = terraform.tfvars

# Inicializar Terraform
init:
	@echo "ğŸ”§ Inicializando Terraform..."
	terraform init

# Validar configuraciÃ³n
validate:
	@echo "âœ… Validando configuraciÃ³n de Terraform..."
	terraform validate

# Formatear cÃ³digo
fmt:
	@echo "ğŸ“ Formateando archivos Terraform..."
	terraform fmt -recursive

# Planificar cambios
plan:
	@echo "ğŸ“‹ Planificando cambios..."
	terraform plan -var-file=$(TF_VAR_FILE)

# Aplicar cambios
apply:
	@echo "ğŸš€ Aplicando cambios..."
	terraform apply -var-file=$(TF_VAR_FILE) -auto-approve

# Aplicar con confirmaciÃ³n
apply-interactive:
	@echo "ğŸš€ Aplicando cambios (con confirmaciÃ³n)..."
	terraform apply -var-file=$(TF_VAR_FILE)

# Destruir infraestructura
destroy:
	@echo "ğŸ—‘ï¸  Destruyendo infraestructura..."
	terraform destroy -var-file=$(TF_VAR_FILE) -auto-approve

# Mostrar outputs
output:
	@echo "ğŸ“¤ Outputs de Terraform:"
	terraform output

# Mostrar estado
show:
	@echo "ğŸ“Š Estado actual:"
	terraform show

# Limpiar archivos temporales
clean:
	@echo "ğŸ§¹ Limpiando archivos temporales..."
	rm -rf .terraform
	rm -f .terraform.lock.hcl
	rm -f terraform.tfstate terraform.tfstate.backup

# Setup completo
setup: init validate fmt
	@echo "âœ… Setup completado"

# Help
help:
	@echo "Comandos disponibles:"
	@echo "  make init              - Inicializar Terraform"
	@echo "  make validate          - Validar configuraciÃ³n"
	@echo "  make fmt               - Formatear cÃ³digo"
	@echo "  make plan              - Planificar cambios"
	@echo "  make apply             - Aplicar cambios (sin confirmaciÃ³n)"
	@echo "  make apply-interactive - Aplicar cambios (con confirmaciÃ³n)"
	@echo "  make destroy           - Destruir infraestructura"
	@echo "  make output            - Mostrar outputs"
	@echo "  make show              - Mostrar estado"
	@echo "  make clean             - Limpiar archivos temporales"
	@echo "  make setup             - Setup completo (init + validate + fmt)"
